sdist:
  stage: build
  image: python:3.8
  only:
    - /^master$/
    - /^v.*$/
    - merge_requests
    - external_pull_requests
  script:
    - python -m pip install --quiet --upgrade pip
    - python -m pip install --quiet --upgrade pep517
    - python -m pep517.build --source --out-dir dist/ .
  artifacts:
    paths:
      - dist/*
bdist:
  stage: build
  image: python:3.8
  only:
    - /^master$/
    - /^v.*$/
    - merge_requests
    - external_pull_requests
  script:
    - python -m pip install --quiet --upgrade pip
    - python -m pip install --quiet --upgrade pep517
    - python -m pep517.build --binary --out-dir dist/ .
  artifacts:
    paths:
      - dist/*
tox_typehints_linux_cpython_3_8:
  stage: test
  image: python:3.8
  only:
    - /^master$/
    - /^v.*$/
    - merge_requests
    - external_pull_requests
  script:
    - python -m pip install --quiet --upgrade pip setuptools wheel
    - python -m pip install tox
    - python -m tox
  variables:
    TOXENV: typehints
tox_linux_cpython_3_6_bdist:
  stage: test
  image: python:3.6
  only:
    - /^master$/
    - /^v.*$/
    - merge_requests
    - external_pull_requests
  needs:
    - bdist
  script:
    - python -m pip install --quiet --upgrade pip setuptools wheel
    - python -m pip install tox
    - python -m tox
  variables:
    TOXENV: py36
