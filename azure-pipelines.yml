name: ciborg
trigger:
  batch: false
stages:
- stage: main
  displayName: Main
  jobs:
  - job: sdist
    displayName: Build sdist
    pool:
      vmImage: ubuntu-16.04
    continueOnError: true
    steps:
    - task: UsePythonVersion@0
      inputs:
        architecture: x64
        versionSpec: '3.7'
    - bash: python setup.py sdist --format=zip
      displayName: Build
      failOnStderr: true
    - task: PublishBuildArtifacts@1
      name: publish
      displayName: Publish
      inputs:
        pathToPublish: $(System.DefaultWorkingDirectory)/dist/
        artifactName: dist
  - job: bdist
    displayName: Build pure wheel
    pool:
      vmImage: ubuntu-16.04
    continueOnError: true
    steps:
    - task: UsePythonVersion@0
      inputs:
        architecture: x64
        versionSpec: '3.7'
    - bash: |-
        python -m pip install --quiet --upgrade pip setuptools wheel
        python setup.py bdist_wheel
      displayName: Build
      failOnStderr: true
    - task: PublishBuildArtifacts@1
      name: publish
      displayName: Publish
      inputs:
        pathToPublish: $(System.DefaultWorkingDirectory)/dist/
        artifactName: dist
  - job: tox_linux_py36_bdist
    displayName: Tox - py36
    pool:
      vmImage: ubuntu-16.04
    dependsOn:
    - bdist
    continueOnError: true
    steps:
    - task: UsePythonVersion@0
      inputs:
        architecture: x64
        versionSpec: '3.6'
    - bash: |-
        python -m pip install --quiet --upgrade pip setuptools wheel
        python -m pip install tox
        python -m tox
      displayName: Tox
      failOnStderr: true
      env:
        TOXENV: py36
  - job: tox_linux_py38_sdist
    displayName: Tox - py38
    pool:
      vmImage: ubuntu-16.04
    dependsOn:
    - sdist
    continueOnError: true
    steps:
    - task: UsePythonVersion@0
      inputs:
        architecture: x64
        versionSpec: '3.8'
    - bash: |-
        python -m pip install --quiet --upgrade pip setuptools wheel
        python -m pip install tox
        python -m tox
      displayName: Tox
      failOnStderr: true
      env:
        TOXENV: py38
  - job: tox_linux_py38_bdist
    displayName: Tox - py38
    pool:
      vmImage: ubuntu-16.04
    dependsOn:
    - bdist
    continueOnError: true
    steps:
    - task: UsePythonVersion@0
      inputs:
        architecture: x64
        versionSpec: '3.8'
    - bash: |-
        python -m pip install --quiet --upgrade pip setuptools wheel
        python -m pip install tox
        python -m tox
      displayName: Tox
      failOnStderr: true
      env:
        TOXENV: py38
  - job: tox_macos_py38_bdist
    displayName: Tox - py38
    pool:
      vmImage: macOS-10.13
    dependsOn:
    - bdist
    continueOnError: true
    steps:
    - task: UsePythonVersion@0
      inputs:
        architecture: x64
        versionSpec: '3.8'
    - bash: |-
        python -m pip install --quiet --upgrade pip setuptools wheel
        python -m pip install tox
        python -m tox
      displayName: Tox
      failOnStderr: true
      env:
        TOXENV: py38
  - job: tox_windows_py38_bdist
    displayName: Tox - py38
    pool:
      vmImage: vs2017-win2016
    dependsOn:
    - bdist
    continueOnError: true
    steps:
    - task: UsePythonVersion@0
      inputs:
        architecture: x64
        versionSpec: '3.8'
    - bash: |-
        python -m pip install --quiet --upgrade pip setuptools wheel
        python -m pip install tox
        python -m tox
      displayName: Tox
      failOnStderr: true
      env:
        TOXENV: py38
